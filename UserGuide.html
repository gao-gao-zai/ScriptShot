<!DOCTYPE html><html><head>
      <title>UserGuide</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Administrator\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.18\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="scriptshot-使用教程">ScriptShot 使用教程 </h1>
<blockquote>
<p>本文是给普通用户看的完整说明，介绍 ScriptShot 的安装、配置、使用脚本自动化，以及常见问题。</p>
</blockquote>
<hr>
<h2 id="1-scriptshot-是什么">1. ScriptShot 是什么？ </h2>
<p>ScriptShot 是一个基于截图的自动化小工具：</p>
<ul>
<li>当你触发一次截屏时，它会自动捕获刚刚的截图；</li>
<li>然后按照你配置的 <strong>脚本（JavaScript）</strong> 对截图做处理，比如：
<ul>
<li>自动把截图旋转 180°；</li>
<li>自动弹出系统分享面板；</li>
<li>或者执行你自定义的逻辑（比如保存到特定目录、调用接口等）。</li>
</ul>
</li>
</ul>
<p>你可以把它理解为：<strong>“用脚本驱动的截屏后自动动作”</strong>。</p>
<hr>
<h2 id="2-安装与基本要求">2. 安装与基本要求 </h2>
<h3 id="21-支持的系统版本">2.1 支持的系统版本 </h3>
<ul>
<li>最低支持：Android 7.0（API 24）及以上；</li>
<li>针对 Android 13 及以上系统，使用新的 <code>READ_MEDIA_IMAGES</code> 权限来访问图片；</li>
<li>无需 root 也可使用（通过无障碍方式）；如果你的手机已 root，可以选择 root 模式获得更好的兼容性。</li>
</ul>
<h3 id="22-安装应用">2.2 安装应用 </h3>
<ol>
<li>把构建好的 <code>app-debug.apk</code> 或发行版 APK 拷贝到手机；</li>
<li>在手机上打开文件管理器，点击 APK 安装；</li>
<li>安装完成后，在桌面上找到 <strong>ScriptShot</strong> 图标并打开。</li>
</ol>
<hr>
<h2 id="3-初次启动基础配置向导">3. 初次启动：基础配置向导 </h2>
<p>首次打开应用，建议按以下顺序完成配置：</p>
<h3 id="步骤-1选择截屏方式capture-mode">步骤 1：选择截屏方式（Capture mode） </h3>
<p>打开应用后会看到配置界面（Config）：</p>
<ul>
<li>顶部有 <strong>Choose capture method</strong>：
<ul>
<li><strong>Root mode</strong>：
<ul>
<li>需要设备已 root，并有可用的 <code>su</code> 命令；</li>
<li>一般来说，捕获流程更直接，对部分厂商系统兼容性更好；</li>
</ul>
</li>
<li><strong>Accessibility mode</strong>：
<ul>
<li>不需要 root；</li>
<li>通过无障碍服务向系统请求截图；</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>你可以根据自己的设备情况选择一种模式，之后随时可以切换。</p>
<h3 id="步骤-2授予媒体存储权限">步骤 2：授予媒体/存储权限 </h3>
<p>在配置页的 <strong>Quick actions</strong> 中有按钮：</p>
<ul>
<li><strong>Grant media permission</strong>：
<ul>
<li>Android 13+：授予 <code>读取照片和视频</code> 权限（READ_MEDIA_IMAGES）；</li>
<li>Android 12 及以下：授予 <code>读取存储</code> 权限（READ_EXTERNAL_STORAGE）；</li>
</ul>
</li>
</ul>
<p>没有这一步，应用无法读取你的最新截图，自动化功能也就无法工作。</p>
<h3 id="步骤-3开启无障碍服务仅-accessibility-模式">步骤 3：开启无障碍服务（仅 Accessibility 模式） </h3>
<p>如果你选择了 <strong>Accessibility mode</strong>：</p>
<ol>
<li>点击配置页中的 <strong>Open accessibility settings</strong>；</li>
<li>在系统无障碍列表中找到 <strong>ScriptShot</strong>；</li>
<li>进入后开启服务并确认提示；</li>
<li>返回应用，点击 <strong>Refresh status</strong> 查看状态是否变为 <code>Available</code>。</li>
</ol>
<h3 id="步骤-4开启脚本自动化与提示">步骤 4：开启脚本自动化与提示 </h3>
<p>在 <strong>Automation &amp; feedback</strong> 分组中，你会看到几个开关：</p>
<ul>
<li><strong>Enable script automation</strong>：是否在每次截屏后自动运行脚本；</li>
<li><strong>Show screenshot captured toast</strong>：截屏被捕获时是否弹出 toast 提示；</li>
<li><strong>Show script success toast</strong>：脚本执行成功时是否提示；</li>
<li><strong>Show script failure toast</strong>：脚本失败时是否提示错误信息；</li>
</ul>
<p>建议：</p>
<ul>
<li>初次使用可以全部打开，方便确认行为；</li>
<li>当你熟悉之后，可以关闭部分 toast，让体验更安静。</li>
</ul>
<hr>
<h2 id="4-快捷方式与快速设置磁贴">4. 快捷方式与快速设置磁贴 </h2>
<p>为方便快速触发自动化，ScriptShot 提供了两个入口：</p>
<h3 id="41-桌面快捷方式shortcut">4.1 桌面快捷方式（Shortcut） </h3>
<p>在配置页中：</p>
<ul>
<li>点击 <strong>Create capture shortcut</strong>：
<ul>
<li>如果你的桌面支持固定快捷方式，会弹系统对话框，确认后在桌面添加一个 <strong>ScriptShot Capture</strong> 图标；</li>
<li>在旧系统或旧桌面中，会尝试通过广播 <code>INSTALL_SHORTCUT</code> 创建图标，结果以桌面实现为准；</li>
</ul>
</li>
<li>之后你只需点击该快捷方式，就会触发一次“静默截屏 + 自动化脚本”。</li>
</ul>
<h3 id="42-快速设置磁贴quick-settings-tile">4.2 快速设置磁贴（Quick Settings Tile） </h3>
<p>应用内有一行提示：</p>
<blockquote>
<p>Add the ScriptShot quick settings tile from the notification shade to trigger silent captures.</p>
</blockquote>
<p>操作方式：</p>
<ol>
<li>从屏幕顶部下拉状态栏，打开快速设置面板；</li>
<li>点击编辑按钮（通常是一个铅笔/编辑图标）；</li>
<li>在可用磁贴列表中找到 <strong>ScriptShot</strong>；</li>
<li>拖动它到上方已启用区域，保存；</li>
<li>之后你只要点一下这个磁贴，就可以快速触发脚本自动化。</li>
</ol>
<hr>
<h2 id="5-管理与编写脚本scripts">5. 管理与编写脚本（Scripts） </h2>
<h3 id="51-打开脚本管理器">5.1 打开脚本管理器 </h3>
<p>在配置页的 <strong>Quick actions</strong> 中点击：</p>
<ul>
<li><strong>Manage scripts</strong></li>
</ul>
<p>会打开脚本管理界面（Script manager），该界面包含：</p>
<ul>
<li>左侧/上方：脚本列表（Available scripts）；</li>
<li>下方：脚本编辑器（Script editor）；</li>
<li>默认脚本信息和若干操作按钮。</li>
</ul>
<h3 id="52-默认脚本与内置示例">5.2 默认脚本与内置示例 </h3>
<p>应用内预置了一些示例脚本，比如：</p>
<ul>
<li><code>旋转截屏.js</code> / <code>rotate_screenshot.js</code>：把每一张新截图旋转 180°；</li>
<li><code>快捷分享.js</code> / <code>quick_share.js</code>：截屏后自动打开系统分享界面；</li>
</ul>
<p>在脚本管理页中你可以看到一段说明文字，简单介绍这些脚本的用法。</p>
<h3 id="53-新建和编辑脚本">5.3 新建和编辑脚本 </h3>
<p>在脚本管理页：</p>
<ol>
<li>在脚本列表中选择一个已有脚本，或者点击 <strong>New script</strong> 新建；</li>
<li>在“Script name”输入框中填写脚本名，例如：<code>my_rename_and_share.js</code>；</li>
<li>在下面的大文本区域编写 JavaScript 代码；</li>
<li>点击 <strong>Save script</strong> 保存脚本到本地存储；</li>
</ol>
<p>推荐做法：</p>
<ul>
<li>名称统一使用 <code>.js</code> 结尾，方便辨认；</li>
<li>不要包含 <code>/</code> 之类的非法字符（应用会提示错误）。</li>
</ul>
<h3 id="54-设为默认脚本与删除覆盖">5.4 设为默认脚本与删除覆盖 </h3>
<p>在脚本编辑器下方，你会看到几个按钮：</p>
<ul>
<li><strong>Set as default</strong>：将当前脚本设为默认脚本；</li>
<li><strong>Delete script override</strong>：删除当前脚本的本地覆盖版本（内置版本仍然可用）；</li>
<li><strong>Create home shortcut</strong>：为当前脚本创建桌面快捷方式（不同于单纯“截图+默认脚本”的快捷方式）。</li>
</ul>
<p>当你在配置页启用自动化时：</p>
<ul>
<li>每次截屏后都会使用“默认脚本”执行；</li>
<li>如果你从某个脚本相关的快捷方式触发，则会执行对应脚本。</li>
</ul>
<hr>
<h2 id="6-编写脚本可用-api-与示例">6. 编写脚本：可用 API 与示例 </h2>
<blockquote>
<p>本节面向“想自己写脚本”的用户，假设你对 JavaScript 有一定了解。</p>
</blockquote>
<h3 id="61-脚本运行环境与内置变量">6.1 脚本运行环境与内置变量 </h3>
<p>ScriptShot 使用 Rhino 引擎执行脚本，支持大部分 ES6 语法。每次执行脚本时，会自动注入以下对象和变量：</p>
<ul>
<li><code>img</code>（<code>ImgApi</code>）：图片处理工具，对截图做旋转、裁剪、加水印等；</li>
<li><code>files</code>（<code>FilesApi</code>）：读写应用私有目录或绝对路径上的文本文件；</li>
<li><code>shell</code>（<code>ShellApi</code>）：执行 <code>sh</code> / <code>su</code> 命令（高级用户使用，需注意安全）；</li>
<li><code>share</code>（<code>ShareApi</code>）：调用系统分享 UI 分享图片；</li>
<li><code>notifications</code>（<code>NotificationApi</code>）：发送通知（在 <code>UiApi</code> 内部会用到）；</li>
<li><code>ui</code>（<code>UiApi</code>）：显示 toast、弹出菜单/日期选择等交互；</li>
<li><code>log</code>：简单日志函数，会把内容写入引擎日志文件 <code>filesDir/scripts/engine.log</code>；</li>
<li><code>screenshotPath</code>：当前这次自动化关联截图的路径（字符串），可能是绝对路径，也可能为空；</li>
<li><code>screenshotMeta</code>：一个包含截图元数据的对象：
<ul>
<li><code>displayName</code>：文件名（不含路径）；</li>
<li><code>sizeBytes</code>：大小（字节）；</li>
<li><code>contentUri</code>：内容 Uri 字符串；</li>
<li><code>path</code>：绝对路径（某些系统下可能为空）；</li>
</ul>
</li>
<li><code>env</code>：一个包含本次触发上下文信息的对象：
<ul>
<li><code>source</code>：触发来源（例如 <code>shortcut_capture</code>、<code>qs_tile</code>、<code>config_test</code> 等）；</li>
<li><code>silent</code>：是否处于静默模式；</li>
<li><code>suppressFeedback</code>：是否抑制 toast 等反馈；</li>
<li><code>skipCapture</code>：这次是否跳过截图（只跑脚本）；</li>
<li><code>scriptName</code>：实际执行的脚本名；</li>
<li><code>requestedScriptName</code>：如果是“指定脚本快捷方式”触发，会包含原始请求脚本名；</li>
<li><code>timestamp</code>：触发时间戳（毫秒）；</li>
<li><code>action</code>：触发的 Intent action（如 <code>com.scriptshot.action.RUN_SCRIPT</code>）；</li>
<li><code>extras</code>：一个 Map，包含触发 Intent 的额外参数（只保留了基础类型/数组）。</li>
</ul>
</li>
</ul>
<blockquote>
<p>提示：<code>screenshotPath</code> 优先使用文件绝对路径，如果为空，你可以使用 <code>screenshotMeta.contentUri</code> 配合系统 API 自己读取。</p>
</blockquote>
<h3 id="62-图片处理img-api-常用方法">6.2 图片处理：<code>img</code> API 常用方法 </h3>
<p>部分常用方法（省略错误处理和返回值判定）：</p>
<ul>
<li>
<p><code>img.rotate(path, degrees)</code></p>
<ul>
<li>按角度旋转图片；如果设备已 root，会尽量在原图覆盖，否则会在公共图库中创建一张经过旋转的新图片；</li>
<li>示例：<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// 把截图旋转 180°</span>
img<span class="token punctuation">.</span><span class="token method function property-access">rotate</span><span class="token punctuation">(</span>screenshotPath<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
</li>
<li>
<p><code>img.resizeToMaxEdge(path, maxEdge, outPath)</code></p>
<ul>
<li>将图片最长边缩放到不超过 <code>maxEdge</code>，结果写入 <code>outPath</code>（如果为 <code>null</code>，会尝试覆盖原图或另存）；</li>
</ul>
</li>
<li>
<p><code>img.cropCenter(path, targetWidth, targetHeight, outPath)</code></p>
<ul>
<li>从中心裁剪出指定宽高区域；</li>
</ul>
</li>
<li>
<p><code>img.blurRect(path, left, top, right, bottom, radius, outPath)</code></p>
<ul>
<li>对矩形区域做简单模糊处理，适合打码隐私信息；</li>
</ul>
</li>
<li>
<p><code>img.watermarkText(path, text, position, textSize, color, paddingPx, outPath)</code></p>
<ul>
<li>在图片上绘制文字水印：
<ul>
<li><code>position</code> 支持：<code>"top_left"</code> / <code>"top_right"</code> / <code>"bottom_left"</code> / <code>"bottom_right"</code> / <code>"center"</code>（也支持简写 <code>tl</code> / <code>tr</code> / <code>bl</code> / <code>br</code>）；</li>
<li><code>color</code> 为 CSS 风格颜色字符串，如 <code>"#FFFFFFFF"</code> 或 <code>"#FF0000"</code>；</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>img.watermarkImage(path, watermarkPath, position, scale, paddingPx, outPath)</code></p>
<ul>
<li>叠加另一张图片作为水印，<code>scale</code> 为水印相对于原图宽度的比例（0~1）；</li>
</ul>
</li>
<li>
<p><code>img.toGrayscale(path, outPath)</code></p>
<ul>
<li>转为黑白图；</li>
</ul>
</li>
<li>
<p><code>img.getLastOutputPath()</code></p>
<ul>
<li>返回最近一次图片操作成功后的输出路径，常用于链式操作：<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code>img<span class="token punctuation">.</span><span class="token method function property-access">rotate</span><span class="token punctuation">(</span>screenshotPath<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> rotated <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token method function property-access">getLastOutputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> screenshotPath<span class="token punctuation">;</span>
share<span class="token punctuation">.</span><span class="token method function property-access">image</span><span class="token punctuation">(</span>rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
</li>
</ul>
<blockquote>
<p>所有方法在失败时一般返回 <code>false</code> 或抛出异常，推荐用 <code>try/catch</code> 包裹。</p>
</blockquote>
<h3 id="63-文件操作files-api">6.3 文件操作：<code>files</code> API </h3>
<ul>
<li>
<p><code>files.read(path)</code> → <code>string</code></p>
<ul>
<li>读取文本文件内容，默认使用 UTF-8；</li>
<li>相对路径会被解析到应用私有文件夹下（<code>context.getFilesDir()</code>）。</li>
</ul>
</li>
<li>
<p><code>files.write(path, content)</code></p>
<ul>
<li>把字符串写入文件（覆盖原内容，不追加）；</li>
</ul>
</li>
<li>
<p><code>files.exists(path)</code> → <code>boolean</code></p>
<ul>
<li>文件是否存在；</li>
</ul>
</li>
<li>
<p><code>files.list(directoryPath)</code> → <code>string[]</code></p>
<ul>
<li>列出目录下的文件名数组（不含路径）。</li>
</ul>
</li>
</ul>
<p>示例：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// 把当前截图路径追加到一个日志文件</span>
<span class="token keyword keyword-const">const</span> logPath <span class="token operator">=</span> <span class="token string">"scriptshot_screens.txt"</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> existing <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token method function property-access">exists</span><span class="token punctuation">(</span>logPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  existing <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token method function property-access">read</span><span class="token punctuation">(</span>logPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
files<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>logPath<span class="token punctuation">,</span> existing <span class="token operator">+</span> screenshotPath <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"logged screenshot to "</span> <span class="token operator">+</span> logPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="64-命令执行shell-api高级慎用">6.4 命令执行：<code>shell</code> API（高级，慎用） </h3>
<ul>
<li>
<p><code>shell.exec(command)</code></p>
<ul>
<li>使用 <code>sh -c</code> 执行命令，无 root；返回一个 <code>ShellResult</code> 对象：
<ul>
<li><code>code</code>：退出码；</li>
<li><code>stdout</code>：标准输出；</li>
<li><code>stderr</code>：错误输出；</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>shell.sudo(command)</code></p>
<ul>
<li>使用 <code>su -c</code> 执行命令，需要设备已 root 且脚本具备权限；</li>
</ul>
</li>
</ul>
<p>示例：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// 非 root 场景下查看 /sdcard 目录</span>
<span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> shell<span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token string">"ls /sdcard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ls /sdcard exit="</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token property-access">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><blockquote>
<p>注意：滥用 shell 可能带来安全风险，请只在自用、可信环境下使用，避免把危险脚本分享给他人。</p>
</blockquote>
<h3 id="65-分享与交互share--ui-api">6.5 分享与交互：<code>share</code> / <code>ui</code> API </h3>
<ul>
<li>
<p><code>share.image(path)</code></p>
<ul>
<li>调用系统分享面板分享一张图片；</li>
<li>会通过 <code>FileProvider</code> 授权临时读取权限，因此路径必须是实际存在的文件；</li>
</ul>
</li>
<li>
<p><code>ui.toast(message)</code></p>
<ul>
<li>在主线程显示一个短 toast 提示；</li>
</ul>
</li>
<li>
<p><code>ui.menu(title, options)</code> → <code>number</code></p>
<ul>
<li>弹出单选菜单对话框，<code>options</code> 可以是 JS 数组、<code>NativeArray</code> 或简单值：<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> index <span class="token operator">=</span> ui<span class="token punctuation">.</span><span class="token method function property-access">menu</span><span class="token punctuation">(</span><span class="token string">"Choose action"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Rotate"</span><span class="token punctuation">,</span> <span class="token string">"Share"</span><span class="token punctuation">,</span> <span class="token string">"Both"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>返回选中索引（0 开始），取消时返回 <code>-1</code>；</li>
</ul>
</li>
<li>
<p><code>ui.menuMulti(title, options)</code> → <code>number[]</code></p>
<ul>
<li>弹出多选菜单，返回选中索引数组；</li>
</ul>
</li>
<li>
<p><code>ui.pickDate(title, initialTimestampMs)</code> → <code>number</code></p>
<ul>
<li>打开日期选择器，返回选中日期的时间戳（毫秒）；取消时返回 <code>-1</code>；</li>
</ul>
</li>
<li>
<p>进度通知（长任务时可选用）：</p>
<ul>
<li><code>const id = ui.progressStart(title, message, totalSteps);</code></li>
<li><code>ui.progressUpdate(id, title, message, currentStep, totalSteps);</code></li>
<li><code>ui.progressFinish(id, title, message, /*dismiss=*/true);</code></li>
</ul>
</li>
</ul>
<h3 id="66-综合示例一个完整的脚本">6.6 综合示例：一个完整的脚本 </h3>
<p><strong>示例 1：旋转并分享截图</strong></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>screenshotPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"No screenshot path; nothing to do"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 旋转 180°</span>
    img<span class="token punctuation">.</span><span class="token method function property-access">rotate</span><span class="token punctuation">(</span>screenshotPath<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> rotated <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token method function property-access">getLastOutputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> screenshotPath<span class="token punctuation">;</span>

    <span class="token comment">// 询问用户是否分享</span>
    <span class="token keyword keyword-const">const</span> choice <span class="token operator">=</span> ui<span class="token punctuation">.</span><span class="token method function property-access">menu</span><span class="token punctuation">(</span><span class="token string">"Screenshot rotated"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Share now"</span><span class="token punctuation">,</span> <span class="token string">"Done"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>choice <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      share<span class="token punctuation">.</span><span class="token method function property-access">image</span><span class="token punctuation">(</span>rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error in rotate+share script: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token punctuation">.</span><span class="token method function property-access">toast</span><span class="token punctuation">(</span><span class="token string">"Script failed: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>示例 2：对截图中间区域打码并保存新文件</strong></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>screenshotPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"No screenshot path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对中间 40% 区域模糊处理</span>
    img<span class="token punctuation">.</span><span class="token method function property-access">blurRect</span><span class="token punctuation">(</span>screenshotPath<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> blurred <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token method function property-access">getLastOutputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> screenshotPath<span class="token punctuation">;</span>

    ui<span class="token punctuation">.</span><span class="token method function property-access">toast</span><span class="token punctuation">(</span><span class="token string">"Blurred screenshot saved: "</span> <span class="token operator">+</span> blurred<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error in blur script: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><blockquote>
<p>你可以在 <code>engine.log</code> 文件中找到 <code>log()</code> 输出的调试信息，位置在应用私有目录下的 <code>files/scripts/engine.log</code>。</p>
</blockquote>
<hr>
<h2 id="7-截图与自动化的实际流程">7. 截图与自动化的实际流程 </h2>
<p>这里简单梳理一次从“截屏”到“脚本执行”的内部流程，你不需要完全理解，但有助于排查问题：</p>
<ol>
<li>你通过桌面快捷方式、快速设置磁贴或其他入口触发 ScriptShot；</li>
<li><code>ShotTriggerActivity</code> 被启动，根据配置判断使用 Root 还是 Accessibility 方式；</li>
<li>应用请求系统截屏：
<ul>
<li>Root 模式：通过 <code>su</code> 命令执行截图相关指令；</li>
<li>无障碍模式：通过无障碍 API 请求屏幕内容；</li>
</ul>
</li>
<li>截图保存到系统截图目录；</li>
<li>ScriptShot 读取最新截图，并调用 Rhino 脚本引擎执行你配置的脚本；</li>
<li>根据你的设置，显示成功/失败 toast，或者静默完成。</li>
</ol>
<hr>
<h2 id="7-常见问题faq">7. 常见问题（FAQ） </h2>
<h3 id="71-没有任何自动化发生">7.1 没有任何自动化发生 </h3>
<p>检查顺序：</p>
<ol>
<li>是否授予了媒体/存储权限？</li>
<li>配置页中 <code>Enable script automation</code> 是否打开？</li>
<li>是否设置了默认脚本？（配置页中有“Current default script: xxx” 一行）</li>
<li>如果使用 Accessibility 模式：
<ul>
<li>无障碍服务是否开启？</li>
<li>设备是否对后台无障碍有特殊限制？</li>
</ul>
</li>
<li>如果使用 Root 模式：
<ul>
<li>设备是否 root？</li>
<li>其它 root 管理应用是否拒绝了 ScriptShot 的请求？</li>
</ul>
</li>
</ol>
<h3 id="72-截图存在但脚本报错">7.2 截图存在，但脚本报错 </h3>
<ul>
<li>打开 Android Studio 或连接电脑，用命令查看日志：</li>
</ul>
<pre data-role="codeBlock" data-info="powershell" class="language-powershell powershell"><code>adb logcat <span class="token punctuation">|</span> <span class="token function">Select-String</span> <span class="token operator">-</span>Pattern <span class="token string">"ScriptShot|EngineManager|AndroidRuntime"</span>
</code></pre><ul>
<li>查看是否有 JavaScript 语法错误、找不到变量、文件读写失败等信息；</li>
<li>在脚本里逐步减少逻辑，先验证简单的例子（例如只弹一个 toast），再逐步加复杂功能。</li>
</ul>
<h3 id="73-无障碍模式截屏失败">7.3 无障碍模式截屏失败 </h3>
<ul>
<li>某些系统（尤其是深度修改的国产 ROM）对“截屏无障碍请求”有额外限制；</li>
<li>可以尝试：
<ul>
<li>确认无障碍服务保持开启状态；</li>
<li>清理后台后重新打开 ScriptShot；</li>
<li>若设备已 root，可切换到 Root 模式尝试。</li>
</ul>
</li>
</ul>
<h3 id="74-root-模式不可用">7.4 Root 模式不可用 </h3>
<ul>
<li>应用检测 Root 会调用 <code>su -c exit</code>：
<ul>
<li>如果返回失败，就会在配置页显示 Root 不可用；</li>
<li>请确保：
<ul>
<li>系统已正确刷入 root；</li>
<li>有可用的 <code>su</code> 二进制；</li>
<li>给 ScriptShot 授予了 root 权限。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="8-建议的使用场景示例">8. 建议的使用场景示例 </h2>
<p>以下是一些 ScriptShot 可以帮忙的典型场景：</p>
<ol>
<li><strong>旋转倒置截图</strong>：
<ul>
<li>某些设备横屏截图方向总是错位，你可以配置脚本在每次截屏后自动旋转 180° 并覆盖保存。</li>
</ul>
</li>
<li><strong>快速分享</strong>：
<ul>
<li>截完图后立刻弹出系统“分享”面板，把图发到微信、Telegram、邮箱等；</li>
</ul>
</li>
<li><strong>自定义备份</strong>：
<ul>
<li>在脚本中把截图复制到特定目录（比如带日期的子目录），形成自己的“截图归档系统”。</li>
</ul>
</li>
</ol>
<p>你可以根据需要将多个脚本组合使用：</p>
<ul>
<li>默认脚本做最常用的事情；</li>
<li>其他脚本通过桌面快捷方式或脚本专用快捷图标触发。</li>
</ul>
<hr>
<h2 id="9-后续扩展">9. 后续扩展 </h2>
<p>如果你是高级用户或开发者，可以进一步：</p>
<ul>
<li>阅读源码中与脚本执行相关的类（例如 <code>ScriptStorage</code>、<code>ShotTriggerActivity</code> 等）；</li>
<li>自己扩展 Rhino 脚本 API，让脚本能做更多事情（例如网络请求、文件操作等——注意安全与权限）；</li>
<li>提交反馈或 PR（如果你托管在公共代码仓库）以改进功能与稳定性。</li>
</ul>
<hr>
<p>如需将本教程内容部分集成到应用内（例如在帮助页面中展示简化版本），可以根据需要从本文件中摘取相关章节。</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>